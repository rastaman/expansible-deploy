---
# tasks file for roles/ceph-node

# Ensure password-less sudo for the nodes
- name: allow sudo without password for the ceph user
  sudo: True
  copy: dest=/etc/sudoers.d/{{ceph_user}} content="{{ceph_user}} ALL = (root) NOPASSWD:ALL"

- name: put the right permissions on the user sudoers file
  file: name=/etc/sudoers.d/{{ceph_user}} state=file mode=0440
  sudo: True



- name: Add public key to ceph nodes and users
  authorized_key: user={{ ceph_user }} key="{{ lookup('file', 'keys/'+ ceph_user + '-' + ceph_admin_node + '-id_rsa.pub') }}"
  sudo: True
